<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="theme-color" content="#0c0a1d">
  <title>Symptom Tracker</title>
  <style>
    * {
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }
    html {
      margin: 0;
      padding: 0;
      height: 100%;
      background: #0c0a1d;
    }
    body {
      margin: 0;
      padding: 0;
      min-height: 100%;
      min-height: 100dvh;
      background: #0c0a1d;
      font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      position: fixed;
      width: 100%;
      overflow: hidden;
    }
    #root {
      margin: 0;
      padding: 0;
      min-height: 100%;
      min-height: 100dvh;
      background: #0c0a1d;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
    }
    body.no-scroll #root {
      overflow: hidden;
    }
  </style>
</head>
<body>
  <div id="root"></div>
  
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  
  <script type="text/babel">
    const { useState, useRef, useEffect } = React;

    const defaultSymptoms = [
      { id: 'red-neck-chest', name: 'Red neck/chest, blotchy skin tone', active: true },
      { id: 'penile-retraction', name: 'Penile retraction', active: true },
      { id: 'pee-dribble', name: 'Pee dribble', active: true },
      { id: 'urinary-urgency', name: 'Urinary urgency', active: true },
      { id: 'daytime-fatigue', name: 'Daytime fatigue', active: true },
      { id: 'irritability', name: 'Irritability', active: true },
      { id: 'social-withdrawal', name: 'Social withdrawal', active: true },
      { id: 'air-hunger-am', name: 'Air hunger AM', active: true },
      { id: 'anxiety-mental', name: 'Anxiety (mental: racing thoughts etc.)', active: true },
      { id: 'anxiety-physical', name: 'Anxiety (physical: chest pressure etc.)', active: true },
      { id: 'low-sexual-drive', name: 'Low sexual drive', active: true },
      { id: 'nerve-pain', name: 'Nerve pain / neuropathy', active: true },
      { id: 'headache', name: 'Headache', active: true },
      { id: 'dysphagia', name: 'Dysphagia', active: true },
      { id: 'fascial-tightness', name: 'Fascial and tendon tightness', active: true },
      { id: 'psoriasis', name: 'Psoriasis', active: true },
      { id: 'diarrhea', name: 'Diarrhea / Loose stool', active: true },
      { id: 'brain-fog', name: 'Brain fog', active: true },
      { id: 'sugar-alcohol-cravings', name: 'Sugar / alcohol cravings', active: true },
      { id: 'heartburn', name: 'Heartburn / bile reflux', active: true },
      { id: 'oral-thrush', name: 'Oral thrush', active: true },
      { id: 'farting-burping', name: 'Farting, burping', active: true },
      { id: 'air-hunger-pm', name: 'Air hunger PM', active: true },
    ];

    const allTimePeriods = [
      { id: 'night', label: 'Night', icon: '☽' },
      { id: 'morning', label: 'Morning', icon: '◐' },
      { id: 'allday', label: 'All Day', icon: '○' },
      { id: 'midday', label: 'Midday', icon: '●' },
      { id: 'evening', label: 'Evening', icon: '◑' },
    ];

    const trackingModes = {
      simple: {
        label: 'Simple',
        description: 'One entry per day',
        periods: [{ id: 'daily', label: 'Daily', icon: '○' }],
      },
      ampm: {
        label: 'AM/PM',
        description: 'Morning and evening',
        periods: [
          { id: 'morning', label: 'AM', icon: '◐' },
          { id: 'evening', label: 'PM', icon: '◑' },
        ],
      },
      detailed: {
        label: 'Detailed',
        description: 'Five time periods',
        periods: allTimePeriods,
      },
    };

    const STORAGE_KEY_MODE = 'symptomTracker_mode';

    const severityLevels = [0, 1, 2, 3, 4, 5];
    const severityColors = {
      0: '#22c55e',
      1: '#4ade80',
      2: '#a3e635',
      3: '#facc15',
      4: '#fb923c',
      5: '#ef4444',
    };
    const severityLabels = ['None', 'Minimal', 'Mild', 'Moderate', 'Severe', 'Extreme'];

    const STORAGE_KEY_SYMPTOMS = 'symptomTracker_symptoms';
    const STORAGE_KEY_ENTRIES = 'symptomTracker_entries';

    const generateSampleData = (symptoms, mode = 'detailed') => {
      const entries = {};
      const today = new Date();
      const periods = trackingModes[mode].periods;
      
      // Define symptom clusters that tend to appear together
      const clusters = {
        digestive: ['diarrhea', 'heartburn', 'farting-burping', 'oral-thrush'],
        anxiety: ['anxiety-mental', 'anxiety-physical', 'irritability', 'social-withdrawal'],
        fatigue: ['daytime-fatigue', 'brain-fog', 'air-hunger-am', 'air-hunger-pm'],
        pain: ['headache', 'nerve-pain', 'fascial-tightness'],
      };
      
      // Monthly trend modifiers (6 months back) - some symptoms improve, some worsen
      const monthlyTrends = {
        'headache': [1.5, 1.3, 1.2, 1.0, 0.8, 0.7], // improving
        'brain-fog': [1.4, 1.3, 1.1, 1.0, 0.9, 0.8], // improving
        'anxiety-mental': [0.7, 0.8, 0.9, 1.0, 1.1, 1.2], // worsening
        'anxiety-physical': [0.7, 0.8, 0.9, 1.0, 1.1, 1.2], // worsening
        'diarrhea': [1.2, 1.0, 0.8, 1.0, 1.2, 1.0], // cyclical
        'heartburn': [1.2, 1.0, 0.8, 1.0, 1.2, 1.0], // cyclical with digestive
        'daytime-fatigue': [1.0, 1.0, 1.0, 1.0, 1.0, 1.0], // stable
        'psoriasis': [0.5, 0.6, 0.8, 1.0, 1.2, 1.3], // worsening
      };

      // Weekly patterns (0 = Sunday)
      const weekendEffect = {
        'sugar-alcohol-cravings': [1.3, 0.8, 0.8, 0.9, 1.0, 1.2, 1.4], // higher on weekends
        'headache': [1.2, 1.1, 0.9, 0.9, 0.9, 1.0, 1.1], // Monday headaches
      };
      
      for (let daysAgo = 0; daysAgo < 180; daysAgo++) {
        const date = new Date(today);
        date.setDate(date.getDate() - daysAgo);
        const dateKey = date.toISOString().split('T')[0];
        const monthsAgo = Math.floor(daysAgo / 30);
        const dayOfWeek = date.getDay();
        
        if (Math.random() < 0.85) {
          // Pick 2-5 symptoms, with cluster correlation
          let selectedSymptomIds = [];
          const activeSymptoms = symptoms.filter(s => s.active);
          
          // 40% chance to activate a cluster
          if (Math.random() < 0.4) {
            const clusterNames = Object.keys(clusters);
            const cluster = clusters[clusterNames[Math.floor(Math.random() * clusterNames.length)]];
            const clusterSymptoms = cluster.filter(id => 
              activeSymptoms.some(s => s.id === id)
            );
            if (clusterSymptoms.length > 0) {
              const numFromCluster = Math.min(clusterSymptoms.length, Math.floor(Math.random() * 2) + 1);
              selectedSymptomIds = clusterSymptoms.slice(0, numFromCluster);
            }
          }
          
          // Add random symptoms
          const numAdditional = Math.floor(Math.random() * 3) + 1;
          const otherSymptoms = activeSymptoms
            .filter(s => !selectedSymptomIds.includes(s.id))
            .sort(() => Math.random() - 0.5)
            .slice(0, numAdditional)
            .map(s => s.id);
          
          selectedSymptomIds = [...selectedSymptomIds, ...otherSymptoms];
          
          selectedSymptomIds.forEach(symptomId => {
            const numPeriods = mode === 'simple' ? 1 : (Math.random() < 0.7 ? 1 : 2);
            const shuffledPeriods = [...periods].sort(() => Math.random() - 0.5).slice(0, numPeriods);
            
            shuffledPeriods.forEach(period => {
              let baseSeverity = Math.floor(Math.random() * 4) + 1;
              
              // Apply monthly trend
              const trend = monthlyTrends[symptomId];
              if (trend && monthsAgo < trend.length) {
                baseSeverity = Math.round(baseSeverity * trend[monthsAgo]);
              }
              
              // Apply weekly pattern
              const weekPattern = weekendEffect[symptomId];
              if (weekPattern) {
                baseSeverity = Math.round(baseSeverity * weekPattern[dayOfWeek]);
              }
              
              // Morning symptoms tend to be worse for some
              if (period.id === 'morning' && ['headache', 'air-hunger-am'].includes(symptomId)) {
                baseSeverity = Math.min(5, baseSeverity + 1);
              }
              
              const key = `${dateKey}-${symptomId}-${period.id}`;
              entries[key] = {
                time: period.id,
                severity: Math.min(5, Math.max(1, baseSeverity)),
                date: dateKey,
                symptomId: symptomId
              };
            });
          });
        }
      }
      
      return entries;
    };

    function SymptomTrackerMobile() {
      const [symptoms, setSymptoms] = useState(() => {
        const saved = localStorage.getItem(STORAGE_KEY_SYMPTOMS);
        return saved ? JSON.parse(saved) : defaultSymptoms;
      });
      const [selectedDate, setSelectedDate] = useState(new Date());
      const [entries, setEntries] = useState(() => {
        const saved = localStorage.getItem(STORAGE_KEY_ENTRIES);
        return saved ? JSON.parse(saved) : {};
      });
      const [hasSampleData, setHasSampleData] = useState(false);
      const [trackingMode, setTrackingMode] = useState(() => {
        const saved = localStorage.getItem(STORAGE_KEY_MODE);
        return saved || 'detailed';
      });
      const [showInsights, setShowInsights] = useState(false);
      
      // Derived time periods based on mode
      const timePeriods = trackingModes[trackingMode].periods;
      
      const [activeSymptom, setActiveSymptom] = useState(null);
      const [dragPosition, setDragPosition] = useState({ x: 2, y: 2 });
      const [isDragging, setIsDragging] = useState(false);
      const [fingerPosition, setFingerPosition] = useState({ x: 0, y: 0 });
      const [lastAction, setLastAction] = useState('');
      const [showAddSymptom, setShowAddSymptom] = useState(false);
      const [showCalendar, setShowCalendar] = useState(false);
      const [showHistory, setShowHistory] = useState(false);
      const [showExport, setShowExport] = useState(false);
      const [showSettings, setShowSettings] = useState(false);
      const [editingSymptomId, setEditingSymptomId] = useState(null);
      const [editingSymptomName, setEditingSymptomName] = useState('');
      const [bulkSymptomInput, setBulkSymptomInput] = useState('');
      const [calendarMonth, setCalendarMonth] = useState(new Date());
      const [historySort, setHistorySort] = useState({ column: 'date', direction: 'desc' });
      const containerRef = useRef(null);
      const startPosRef = useRef({ x: 0, y: 0 });
      const holdTimerRef = useRef(null);
      const pendingSymptomRef = useRef(null);

      const DRAG_SENSITIVITY = 19;
      const HOLD_DELAY = 200;

      useEffect(() => {
        localStorage.setItem(STORAGE_KEY_SYMPTOMS, JSON.stringify(symptoms));
      }, [symptoms]);

      useEffect(() => {
        localStorage.setItem(STORAGE_KEY_ENTRIES, JSON.stringify(entries));
      }, [entries]);

      useEffect(() => {
        localStorage.setItem(STORAGE_KEY_MODE, trackingMode);
      }, [trackingMode]);

      // Lock body scroll when dragging
      useEffect(() => {
        if (isDragging) {
          document.body.classList.add('no-scroll');
        } else {
          document.body.classList.remove('no-scroll');
        }
        return () => document.body.classList.remove('no-scroll');
      }, [isDragging]);

      const getDateKey = (date) => date.toISOString().split('T')[0];

      const formatDate = (date) => {
        const today = new Date();
        const yesterday = new Date(today);
        yesterday.setDate(yesterday.getDate() - 1);
        const tomorrow = new Date(today);
        tomorrow.setDate(tomorrow.getDate() + 1);

        if (date.toDateString() === today.toDateString()) return 'Today';
        if (date.toDateString() === yesterday.toDateString()) return 'Yesterday';
        if (date.toDateString() === tomorrow.toDateString()) return 'Tomorrow';
        
        return date.toLocaleDateString('en-US', { 
          weekday: 'short', 
          month: 'short', 
          day: 'numeric' 
        });
      };

      const formatTableDate = (dateStr) => {
        const date = new Date(dateStr);
        return date.toLocaleDateString('en-US', { 
          month: 'short', 
          day: 'numeric',
          year: '2-digit'
        });
      };

      const loadSampleData = () => {
        const sampleEntries = generateSampleData(symptoms, trackingMode);
        setEntries(sampleEntries);
        setHasSampleData(true);
        setShowSettings(false);
        setLastAction(`Loaded ${Object.keys(sampleEntries).length} sample entries`);
      };

      const clearAllData = () => {
        setEntries({});
        setHasSampleData(false);
        setShowSettings(false);
        setLastAction('All data cleared');
      };

      const changeDate = (days) => {
        const newDate = new Date(selectedDate);
        newDate.setDate(newDate.getDate() + days);
        setSelectedDate(newDate);
        setLastAction('');
      };

      const selectDate = (date) => {
        setSelectedDate(date);
        setShowCalendar(false);
        setLastAction('');
      };

      const enterEditMode = (symptomId, clientX, clientY) => {
        const screenHeight = window.innerHeight;
        const relativeY = clientY / screenHeight;
        let initialSeverity;
        if (relativeY < 0.25) {
          initialSeverity = 5;
        } else if (relativeY > 0.75) {
          initialSeverity = 0;
        } else {
          initialSeverity = 2;
        }
        
        // Calculate time index based on mode
        let clampedTimeIndex = 0;
        if (trackingMode !== 'simple') {
          const screenWidth = window.innerWidth;
          const numPeriods = timePeriods.length;
          const timeIndex = Math.floor((clientX / screenWidth) * numPeriods);
          clampedTimeIndex = Math.max(0, Math.min(numPeriods - 1, timeIndex));
        }
        
        setActiveSymptom(symptomId);
        setDragPosition({ x: clampedTimeIndex, y: initialSeverity });
        setIsDragging(true);
        pendingSymptomRef.current = null;
      };

      const handleTouchStart = (e, symptomId) => {
        const touch = e.touches[0];
        startPosRef.current = { x: touch.clientX, y: touch.clientY };
        setFingerPosition({ x: touch.clientX, y: touch.clientY });
        pendingSymptomRef.current = symptomId;
        
        holdTimerRef.current = setTimeout(() => {
          if (pendingSymptomRef.current === symptomId) {
            enterEditMode(symptomId, touch.clientX, touch.clientY);
          }
        }, HOLD_DELAY);
      };

      const handleMouseDown = (e, symptomId) => {
        e.preventDefault();
        startPosRef.current = { x: e.clientX, y: e.clientY };
        setFingerPosition({ x: e.clientX, y: e.clientY });
        pendingSymptomRef.current = symptomId;
        
        holdTimerRef.current = setTimeout(() => {
          if (pendingSymptomRef.current === symptomId) {
            enterEditMode(symptomId, e.clientX, e.clientY);
          }
        }, HOLD_DELAY);
      };

      const handleMove = (clientX, clientY) => {
        if (pendingSymptomRef.current && !isDragging) {
          const deltaX = Math.abs(clientX - startPosRef.current.x);
          const deltaY = Math.abs(clientY - startPosRef.current.y);
          
          if (deltaX > 10 || deltaY > 10) {
            if (holdTimerRef.current) {
              clearTimeout(holdTimerRef.current);
              holdTimerRef.current = null;
            }
            pendingSymptomRef.current = null;
          }
          return;
        }
        
        if (!isDragging || !activeSymptom) return;
        
        setFingerPosition({ x: clientX, y: clientY });
        
        // Calculate time index based on mode
        let timeIndex = 0;
        if (trackingMode !== 'simple') {
          const screenWidth = window.innerWidth;
          const numPeriods = timePeriods.length;
          timeIndex = Math.floor((clientX / screenWidth) * numPeriods);
          timeIndex = Math.max(0, Math.min(numPeriods - 1, timeIndex));
        }
        
        const deltaY = startPosRef.current.y - clientY;
        let severityDelta = Math.round(deltaY / DRAG_SENSITIVITY);
        
        const screenHeight = window.innerHeight;
        const relativeStartY = startPosRef.current.y / screenHeight;
        let baseSeverity;
        if (relativeStartY < 0.25) {
          baseSeverity = 5;
        } else if (relativeStartY > 0.75) {
          baseSeverity = 0;
        } else {
          baseSeverity = 2;
        }
        
        let severityIndex = baseSeverity + severityDelta;
        severityIndex = Math.max(0, Math.min(5, severityIndex));
        
        setDragPosition({ x: timeIndex, y: severityIndex });
      };

      const handleTouchMove = (e) => {
        const touch = e.touches[0];
        handleMove(touch.clientX, touch.clientY);
      };

      const handleMouseMove = (e) => {
        handleMove(e.clientX, e.clientY);
      };

      const handleEnd = () => {
        if (holdTimerRef.current) {
          clearTimeout(holdTimerRef.current);
          holdTimerRef.current = null;
        }
        pendingSymptomRef.current = null;
        
        if (isDragging && activeSymptom) {
          const dateKey = getDateKey(selectedDate);
          const timeId = timePeriods[dragPosition.x].id;
          const severity = dragPosition.y;
          const key = `${dateKey}-${activeSymptom}-${timeId}`;
          
          setEntries({
            ...entries,
            [key]: { time: timeId, severity, date: dateKey, symptomId: activeSymptom }
          });
          
          const symptom = symptoms.find(s => s.id === activeSymptom);
          setLastAction(`${symptom?.name}: ${timePeriods[dragPosition.x].label}, ${severity}`);
        }
        setIsDragging(false);
        setActiveSymptom(null);
      };

      const getSymptomEntries = (symptomId) => {
        const dateKey = getDateKey(selectedDate);
        return Object.entries(entries)
          .filter(([key]) => key.startsWith(`${dateKey}-${symptomId}`))
          .map(([key, value]) => value);
      };

      const getDaysWithEntries = () => {
        const days = new Set();
        Object.keys(entries).forEach(key => {
          const dateKey = key.split('-').slice(0, 3).join('-');
          days.add(dateKey);
        });
        return days;
      };

      const parseBulkSymptoms = (input) => {
        return input
          .split(/[,\t\n\r;]+/)
          .map(s => s.trim())
          .filter(s => s.length > 0);
      };

      const addBulkSymptoms = () => {
        const names = parseBulkSymptoms(bulkSymptomInput);
        if (names.length === 0) return;

        const newSymptoms = [...symptoms];
        let addedCount = 0;

        names.forEach(name => {
          const existing = newSymptoms.find(s => s.name.toLowerCase() === name.toLowerCase());
          if (existing) {
            if (!existing.active) {
              existing.active = true;
              addedCount++;
            }
          } else {
            const id = name.toLowerCase().replace(/\s+/g, '-') + '-' + Date.now() + Math.random();
            newSymptoms.push({ id, name, active: true });
            addedCount++;
          }
        });

        setSymptoms(newSymptoms);
        setBulkSymptomInput('');
        setLastAction(`Added ${addedCount} symptom${addedCount !== 1 ? 's' : ''}`);
      };

      const removeSymptom = (symptomId) => {
        setSymptoms(symptoms.map(s => 
          s.id === symptomId ? { ...s, active: false } : s
        ));
        setLastAction('Symptom hidden (history preserved)');
      };

      const reactivateSymptom = (symptomId) => {
        setSymptoms(symptoms.map(s => 
          s.id === symptomId ? { ...s, active: true } : s
        ));
        setLastAction('Symptom restored');
      };

      const startEditingSymptom = (symptom) => {
        setEditingSymptomId(symptom.id);
        setEditingSymptomName(symptom.name);
      };

      const saveSymptomName = () => {
        if (editingSymptomName.trim() && editingSymptomId) {
          setSymptoms(symptoms.map(s => 
            s.id === editingSymptomId ? { ...s, name: editingSymptomName.trim() } : s
          ));
          setLastAction('Symptom renamed');
        }
        setEditingSymptomId(null);
        setEditingSymptomName('');
      };

      const cancelEditingSymptom = () => {
        setEditingSymptomId(null);
        setEditingSymptomName('');
      };

      const clearEntry = (symptomId, timeId) => {
        const dateKey = getDateKey(selectedDate);
        const key = `${dateKey}-${symptomId}-${timeId}`;
        const newEntries = { ...entries };
        delete newEntries[key];
        setEntries(newEntries);
        setLastAction('Entry cleared');
      };

      const getCalendarDays = () => {
        const year = calendarMonth.getFullYear();
        const month = calendarMonth.getMonth();
        const firstDay = new Date(year, month, 1);
        const lastDay = new Date(year, month + 1, 0);
        const daysInMonth = lastDay.getDate();
        const startingDay = firstDay.getDay();
        
        const days = [];
        for (let i = 0; i < startingDay; i++) {
          days.push(null);
        }
        for (let i = 1; i <= daysInMonth; i++) {
          days.push(new Date(year, month, i));
        }
        return days;
      };

      const getSortedHistory = () => {
        const history = Object.entries(entries).map(([key, value]) => ({
          ...value,
          key,
          symptomName: symptoms.find(s => s.id === value.symptomId)?.name || value.symptomId,
          timePeriodLabel: timePeriods.find(t => t.id === value.time)?.label || value.time,
        }));

        return history.sort((a, b) => {
          let comparison = 0;
          
          switch (historySort.column) {
            case 'date':
              comparison = a.date.localeCompare(b.date);
              break;
            case 'symptom':
              comparison = a.symptomName.localeCompare(b.symptomName);
              break;
            case 'time':
              const timeOrder = { night: 0, morning: 1, allday: 2, midday: 3, evening: 4 };
              comparison = (timeOrder[a.time] || 0) - (timeOrder[b.time] || 0);
              break;
            case 'severity':
              comparison = a.severity - b.severity;
              break;
            default:
              comparison = 0;
          }
          
          return historySort.direction === 'asc' ? comparison : -comparison;
        });
      };

      const toggleSort = (column) => {
        if (historySort.column === column) {
          setHistorySort({
            column,
            direction: historySort.direction === 'asc' ? 'desc' : 'asc'
          });
        } else {
          setHistorySort({ column, direction: 'desc' });
        }
      };

      const getSortIndicator = (column) => {
        if (historySort.column !== column) return '';
        return historySort.direction === 'asc' ? ' ↑' : ' ↓';
      };

      const getInsights = () => {
        const today = new Date();
        const entryList = Object.values(entries);
        
        if (entryList.length < 7) {
          return { hasEnoughData: false };
        }
        
        // Group entries by symptom
        const bySymptom = {};
        entryList.forEach(entry => {
          if (!bySymptom[entry.symptomId]) bySymptom[entry.symptomId] = [];
          bySymptom[entry.symptomId].push(entry);
        });
        
        // Calculate trends for each symptom
        const trends = [];
        Object.entries(bySymptom).forEach(([symptomId, symptomEntries]) => {
          if (symptomEntries.length < 3) return;
          
          const symptom = symptoms.find(s => s.id === symptomId);
          if (!symptom) return;
          
          // Split into recent (last 30 days) vs earlier
          const recentEntries = symptomEntries.filter(e => {
            const daysAgo = Math.floor((today - new Date(e.date)) / (1000 * 60 * 60 * 24));
            return daysAgo <= 30;
          });
          const earlierEntries = symptomEntries.filter(e => {
            const daysAgo = Math.floor((today - new Date(e.date)) / (1000 * 60 * 60 * 24));
            return daysAgo > 30 && daysAgo <= 90;
          });
          
          if (recentEntries.length < 2 || earlierEntries.length < 2) return;
          
          const recentAvg = recentEntries.reduce((sum, e) => sum + e.severity, 0) / recentEntries.length;
          const earlierAvg = earlierEntries.reduce((sum, e) => sum + e.severity, 0) / earlierEntries.length;
          
          const change = recentAvg - earlierAvg;
          const percentChange = ((recentAvg - earlierAvg) / earlierAvg) * 100;
          
          let trend = 'stable';
          if (change < -0.3) trend = 'improving';
          if (change > 0.3) trend = 'worsening';
          
          trends.push({
            symptomId,
            name: symptom.name,
            recentAvg: recentAvg.toFixed(1),
            earlierAvg: earlierAvg.toFixed(1),
            change: change.toFixed(1),
            percentChange: percentChange.toFixed(0),
            trend,
            entryCount: symptomEntries.length,
          });
        });
        
        // Sort by absolute change
        trends.sort((a, b) => Math.abs(b.change) - Math.abs(a.change));
        
        // Find symptom clusters (co-occurrence)
        const coOccurrence = {};
        const dateGroups = {};
        entryList.forEach(entry => {
          if (!dateGroups[entry.date]) dateGroups[entry.date] = new Set();
          dateGroups[entry.date].add(entry.symptomId);
        });
        
        Object.values(dateGroups).forEach(symptomSet => {
          const symptomArray = Array.from(symptomSet);
          for (let i = 0; i < symptomArray.length; i++) {
            for (let j = i + 1; j < symptomArray.length; j++) {
              const key = [symptomArray[i], symptomArray[j]].sort().join('|');
              coOccurrence[key] = (coOccurrence[key] || 0) + 1;
            }
          }
        });
        
        const clusters = Object.entries(coOccurrence)
          .filter(([_, count]) => count >= 5)
          .map(([pair, count]) => {
            const [id1, id2] = pair.split('|');
            const name1 = symptoms.find(s => s.id === id1)?.name || id1;
            const name2 = symptoms.find(s => s.id === id2)?.name || id2;
            return { pair: [name1, name2], count };
          })
          .sort((a, b) => b.count - a.count)
          .slice(0, 5);
        
        // Time of day patterns
        const timePatterns = {};
        entryList.forEach(entry => {
          if (!timePatterns[entry.time]) timePatterns[entry.time] = { total: 0, count: 0 };
          timePatterns[entry.time].total += entry.severity;
          timePatterns[entry.time].count++;
        });
        
        const timeInsights = Object.entries(timePatterns)
          .map(([time, data]) => ({
            time,
            label: allTimePeriods.find(t => t.id === time)?.label || time,
            avgSeverity: (data.total / data.count).toFixed(1),
            count: data.count,
          }))
          .sort((a, b) => b.avgSeverity - a.avgSeverity);
        
        // Weekly patterns
        const dayOfWeekData = Array(7).fill(null).map(() => ({ total: 0, count: 0 }));
        const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
        entryList.forEach(entry => {
          const day = new Date(entry.date).getDay();
          dayOfWeekData[day].total += entry.severity;
          dayOfWeekData[day].count++;
        });
        
        const weeklyInsights = dayOfWeekData
          .map((data, idx) => ({
            day: dayNames[idx],
            avgSeverity: data.count > 0 ? (data.total / data.count).toFixed(1) : null,
            count: data.count,
          }))
          .filter(d => d.avgSeverity !== null);
        
        // Generate AI prompt
        const aiPrompt = generateAIPrompt(trends, clusters, timeInsights, weeklyInsights);
        
        return {
          hasEnoughData: true,
          trends,
          clusters,
          timeInsights,
          weeklyInsights,
          aiPrompt,
          totalEntries: entryList.length,
          dateRange: {
            start: entryList.reduce((min, e) => e.date < min ? e.date : min, entryList[0].date),
            end: entryList.reduce((max, e) => e.date > max ? e.date : max, entryList[0].date),
          },
        };
      };

      const generateAIPrompt = (trends, clusters, timeInsights, weeklyInsights) => {
        let prompt = `Please analyze my symptom tracking data and provide insights. Be cautious with language and avoid prescriptive medical advice.\n\n`;
        
        prompt += `## Symptom Trends (Last 30 days vs prior 60 days)\n`;
        trends.forEach(t => {
          prompt += `- ${t.name}: ${t.trend} (${t.earlierAvg} → ${t.recentAvg}, ${t.change > 0 ? '+' : ''}${t.change})\n`;
        });
        
        if (clusters.length > 0) {
          prompt += `\n## Symptom Clusters (frequently occur together)\n`;
          clusters.forEach(c => {
            prompt += `- "${c.pair[0]}" and "${c.pair[1]}" appeared together ${c.count} times\n`;
          });
        }
        
        if (timeInsights.length > 0) {
          prompt += `\n## Time of Day Patterns\n`;
          timeInsights.forEach(t => {
            prompt += `- ${t.label}: avg severity ${t.avgSeverity} (${t.count} entries)\n`;
          });
        }
        
        if (weeklyInsights.length > 0) {
          prompt += `\n## Weekly Patterns\n`;
          weeklyInsights.forEach(w => {
            prompt += `- ${w.day}: avg severity ${w.avgSeverity}\n`;
          });
        }
        
        prompt += `\nPlease identify:\n1. Any concerning patterns\n2. Potential symptom groupings that might share underlying causes\n3. Suggestions for what to discuss with a healthcare provider\n4. Any positive trends worth noting`;
        
        return prompt;
      };

      const exportCSV = (days) => {
        const endDate = new Date();
        const startDate = new Date();
        startDate.setDate(startDate.getDate() - days);
        
        const rows = [['Date', 'Symptom', 'Time Period', 'Severity', 'Severity Label']];
        
        Object.entries(entries).forEach(([key, entry]) => {
          const entryDate = new Date(entry.date);
          if (entryDate >= startDate && entryDate <= endDate) {
            const symptomName = symptoms.find(s => s.id === entry.symptomId)?.name || entry.symptomId;
            const timePeriod = timePeriods.find(t => t.id === entry.time)?.label || entry.time;
            rows.push([entry.date, symptomName, timePeriod, entry.severity, severityLabels[entry.severity]]);
          }
        });
        
        rows.sort((a, b) => {
          if (a[0] === 'Date') return -1;
          if (b[0] === 'Date') return 1;
          return b[0].localeCompare(a[0]);
        });
        
        const csv = rows.map(row => row.join(',')).join('\n');
        const blob = new Blob([csv], { type: 'text/csv' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `symptoms-${days}days-${getDateKey(new Date())}.csv`;
        a.click();
        URL.revokeObjectURL(url);
        setShowExport(false);
        setLastAction(`Exported ${rows.length - 1} entries`);
      };

      const daysWithEntries = getDaysWithEntries();
      const activeSymptoms = symptoms.filter(s => s.active);
      const inactiveSymptoms = symptoms.filter(s => !s.active);
      const sortedHistory = getSortedHistory();
      const currentSymptomName = symptoms.find(s => s.id === activeSymptom)?.name || '';

      const tableHeaderStyle = {
        padding: '12px 8px',
        textAlign: 'left',
        color: '#94a3b8',
        fontSize: '11px',
        fontWeight: '600',
        textTransform: 'uppercase',
        letterSpacing: '0.5px',
        cursor: 'pointer',
        borderBottom: '2px solid rgba(99, 102, 241, 0.3)',
        whiteSpace: 'nowrap',
        userSelect: 'none',
      };

      const tableCellStyle = {
        padding: '10px 8px',
        fontSize: '13px',
        borderBottom: '1px solid rgba(99, 102, 241, 0.1)',
      };

      return (
        <div 
          ref={containerRef}
          onMouseMove={handleMouseMove}
          onMouseUp={handleEnd}
          onMouseLeave={handleEnd}
          onTouchMove={handleTouchMove}
          onTouchEnd={handleEnd}
          style={{
            height: '100vh',
            background: 'linear-gradient(180deg, #0c0a1d 0%, #1a1333 100%)',
            fontFamily: "'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif",
            userSelect: 'none',
            WebkitUserSelect: 'none',
            WebkitTouchCallout: 'none',
            display: 'flex',
            flexDirection: 'column',
            overflow: 'hidden',
          }}
        >
          {/* Fixed Header Area */}
          <div style={{
            flexShrink: 0,
            padding: '20px 16px 16px',
            background: 'linear-gradient(180deg, #0c0a1d 0%, #1a1333 100%)',
            zIndex: 100,
          }}>
            {/* Date Navigation Header */}
            <div style={{
              display: 'flex',
              alignItems: 'center',
              justifyContent: 'space-between',
              marginBottom: '16px',
            }}>
            <button
              onClick={() => changeDate(-1)}
              style={{
                background: 'rgba(99, 102, 241, 0.15)',
                border: '1px solid rgba(99, 102, 241, 0.3)',
                borderRadius: '12px',
                width: '44px',
                height: '44px',
                color: '#a5b4fc',
                fontSize: '20px',
                cursor: 'pointer',
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center',
              }}
            >
              ‹
            </button>
            
            <button
              onClick={() => {
                setCalendarMonth(new Date(selectedDate));
                setShowCalendar(true);
              }}
              style={{
                background: 'transparent',
                border: 'none',
                cursor: 'pointer',
                textAlign: 'center',
                padding: '4px 12px',
              }}
            >
              <h1 style={{
                color: '#f8fafc',
                fontSize: '22px',
                fontWeight: '700',
                margin: 0,
                display: 'flex',
                alignItems: 'baseline',
                justifyContent: 'center',
                gap: '8px',
              }}>
                {formatDate(selectedDate)}
                <span style={{
                  fontSize: '10px',
                  color: '#64748b',
                  fontWeight: '400',
                }}>v1.0</span>
              </h1>
              <p style={{
                color: '#6366f1',
                fontSize: '12px',
                margin: '2px 0 0 0',
              }}>
                Tap for calendar
              </p>
            </button>

            <button
              onClick={() => changeDate(1)}
              style={{
                background: 'rgba(99, 102, 241, 0.15)',
                border: '1px solid rgba(99, 102, 241, 0.3)',
                borderRadius: '12px',
                width: '44px',
                height: '44px',
                color: '#a5b4fc',
                fontSize: '20px',
                cursor: 'pointer',
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center',
              }}
            >
              ›
            </button>
          </div>

          {/* Action Bar */}
          <div style={{
            display: 'flex',
            gap: '8px',
          }}>
            <button
              onClick={() => setShowHistory(true)}
              style={{
                flex: 1,
                background: 'rgba(99, 102, 241, 0.1)',
                border: '1px solid rgba(99, 102, 241, 0.2)',
                borderRadius: '10px',
                padding: '10px',
                color: '#a5b4fc',
                fontSize: '13px',
                cursor: 'pointer',
              }}
            >
              History
            </button>
            <button
              onClick={() => setShowInsights(true)}
              style={{
                flex: 1,
                background: 'rgba(74, 222, 128, 0.1)',
                border: '1px solid rgba(74, 222, 128, 0.2)',
                borderRadius: '10px',
                padding: '10px',
                color: '#86efac',
                fontSize: '13px',
                cursor: 'pointer',
              }}
            >
              Insights
            </button>
            <button
              onClick={() => setShowExport(true)}
              style={{
                flex: 1,
                background: 'rgba(99, 102, 241, 0.1)',
                border: '1px solid rgba(99, 102, 241, 0.2)',
                borderRadius: '10px',
                padding: '10px',
                color: '#a5b4fc',
                fontSize: '13px',
                cursor: 'pointer',
              }}
            >
              Export
            </button>
            <button
              onClick={() => setShowSettings(true)}
              style={{
                width: '44px',
                background: 'rgba(99, 102, 241, 0.1)',
                border: '1px solid rgba(99, 102, 241, 0.2)',
                borderRadius: '10px',
                padding: '10px',
                color: '#a5b4fc',
                fontSize: '16px',
                cursor: 'pointer',
              }}
            >
              ⚙
            </button>
          </div>
          </div>

          {/* Scrollable Symptom List Area */}
          <div style={{
            flex: 1,
            overflowY: 'auto',
            overflowX: 'hidden',
            padding: '0 16px 100px 16px',
            WebkitOverflowScrolling: 'touch',
          }}>
            <div style={{
              display: 'flex',
              flexDirection: 'column',
              gap: '8px',
            }}>
            {activeSymptoms.map((symptom) => {
              const symptomEntries = getSymptomEntries(symptom.id);
              const isActive = activeSymptom === symptom.id;
              
              return (
                <div
                  key={symptom.id}
                  onTouchStart={(e) => handleTouchStart(e, symptom.id)}
                  onMouseDown={(e) => handleMouseDown(e, symptom.id)}
                  style={{
                    background: isActive 
                      ? 'rgba(99, 102, 241, 0.15)' 
                      : 'rgba(30, 27, 75, 0.6)',
                    borderRadius: '14px',
                    padding: '14px 16px',
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'space-between',
                    border: isActive 
                      ? '2px solid rgba(99, 102, 241, 0.5)' 
                      : '2px solid transparent',
                    cursor: 'pointer',
                    transition: 'all 0.15s ease',
                    transform: isActive ? 'scale(1.02)' : 'scale(1)',
                  }}
                >
                  <span style={{
                    color: '#e2e8f0',
                    fontSize: '16px',
                    fontWeight: '600',
                  }}>{symptom.name}</span>
                  
                  <div style={{
                    display: 'flex',
                    gap: '5px',
                    flexWrap: 'wrap',
                    justifyContent: 'flex-end',
                    maxWidth: '180px',
                  }}>
                    {symptomEntries.length === 0 ? (
                      <span style={{ color: '#475569', fontSize: '12px' }}>
                        Hold to log
                      </span>
                    ) : (
                      symptomEntries.map((entry, idx) => (
                        <div 
                          key={idx} 
                          onClick={(e) => {
                            e.stopPropagation();
                            clearEntry(symptom.id, entry.time);
                          }}
                          style={{
                            background: `${severityColors[entry.severity]}20`,
                            border: `1.5px solid ${severityColors[entry.severity]}`,
                            borderRadius: '6px',
                            padding: '4px 8px',
                            display: 'flex',
                            alignItems: 'center',
                            gap: '4px',
                            cursor: 'pointer',
                          }}
                        >
                          <span style={{
                            fontSize: '12px',
                            color: '#a5b4fc',
                          }}>
                            {timePeriods.find(t => t.id === entry.time)?.icon}
                          </span>
                          <span style={{
                            color: severityColors[entry.severity],
                            fontSize: '13px',
                            fontWeight: '700',
                          }}>{entry.severity}</span>
                        </div>
                      ))
                    )}
                  </div>
                </div>
              );
            })}

            <button
              onClick={() => setShowAddSymptom(true)}
              style={{
                background: 'transparent',
                border: '2px dashed rgba(99, 102, 241, 0.3)',
                borderRadius: '14px',
                padding: '16px',
                color: '#6366f1',
                fontSize: '15px',
                fontWeight: '500',
                cursor: 'pointer',
                marginTop: '4px',
              }}
            >
              + Add Symptoms
            </button>
            </div>
          </div>

          {/* 2D Drag Picker Overlay - Simplified Full Screen */}
          {isDragging && activeSymptom && (
            <div style={{
              position: 'fixed',
              inset: 0,
              background: '#0a1628',
              display: 'flex',
              flexDirection: 'column',
              zIndex: 1000,
              touchAction: 'none',
            }}>
              {/* Severity color bar at very top */}
              <div style={{
                position: 'fixed',
                top: 0,
                left: 0,
                right: 0,
                height: '5px',
                background: severityColors[dragPosition.y],
                zIndex: 1002,
                transition: 'background 0.1s ease',
              }} />

              {/* Screen zone indicators - 5 vertical sections */}
              <div style={{
                position: 'absolute',
                inset: 0,
                display: 'flex',
                pointerEvents: 'none',
              }}>
                {timePeriods.map((period, idx) => (
                  <div 
                    key={period.id}
                    style={{
                      flex: 1,
                      borderRight: idx < 4 ? '1px solid rgba(99, 102, 241, 0.15)' : 'none',
                      background: dragPosition.x === idx ? 'rgba(99, 102, 241, 0.08)' : 'transparent',
                      transition: 'background 0.1s ease',
                    }}
                  />
                ))}
              </div>

              {/* Top zone - Time period icons (hidden in simple mode) */}
              {trackingMode !== 'simple' && (
                <div style={{
                  position: 'fixed',
                  top: 5,
                  left: 0,
                  right: 0,
                  display: 'flex',
                  background: 'linear-gradient(180deg, #0a1628 0%, #0c1929 100%)',
                }}>
                  {timePeriods.map((period, idx) => (
                    <div 
                      key={period.id}
                      style={{
                        flex: 1,
                        padding: '24px 8px 16px',
                        textAlign: 'center',
                        background: dragPosition.x === idx ? 'rgba(99, 102, 241, 0.25)' : 'transparent',
                        borderRight: idx < timePeriods.length - 1 ? '1px solid rgba(99, 102, 241, 0.1)' : 'none',
                        transition: 'background 0.1s ease',
                      }}
                    >
                      <div style={{
                        fontSize: '28px',
                        marginBottom: '4px',
                        opacity: dragPosition.x === idx ? 1 : 0.6,
                        transition: 'opacity 0.1s',
                        color: dragPosition.x === idx ? '#fff' : '#a5b4fc',
                      }}>
                        {period.icon}
                      </div>
                      <div style={{
                        fontSize: '11px',
                        color: dragPosition.x === idx ? '#fff' : '#94a3b8',
                        fontWeight: dragPosition.x === idx ? '700' : '500',
                        textTransform: 'uppercase',
                        letterSpacing: '0.5px',
                        transition: 'all 0.1s',
                      }}>
                        {period.label}
                      </div>
                    </div>
                  ))}
                </div>
              )}

              {/* Symptom Name - below time icons */}
              <div style={{
                paddingTop: trackingMode === 'simple' ? '40px' : '120px',
                textAlign: 'center',
              }}>
                <h1 style={{
                  color: '#f8fafc',
                  fontSize: '28px',
                  fontWeight: '700',
                  margin: 0,
                  padding: '0 24px',
                }}>
                  {currentSymptomName}
                </h1>
              </div>

              {/* Big Floating Number - Follows finger, stays below header */}
              <div style={{
                position: 'fixed',
                left: `${Math.max(60, Math.min(window.innerWidth - 60, fingerPosition.x))}px`,
                top: `${Math.max(230, Math.min(window.innerHeight - 150, fingerPosition.y - 130))}px`,
                transform: 'translate(-50%, -50%)',
                pointerEvents: 'none',
                zIndex: 1001,
                textAlign: 'center',
              }}>
                <div style={{
                  fontSize: '120px',
                  fontWeight: '800',
                  color: severityColors[dragPosition.y],
                  textShadow: `0 0 60px ${severityColors[dragPosition.y]}80`,
                  lineHeight: 1,
                  transition: 'color 0.1s ease, text-shadow 0.1s ease',
                }}>
                  {dragPosition.y}
                </div>
                <div style={{
                  color: '#94a3b8',
                  fontSize: '14px',
                  fontWeight: '500',
                  marginTop: '8px',
                  textTransform: 'uppercase',
                  letterSpacing: '1px',
                }}>
                  {severityLabels[dragPosition.y]}
                </div>
              </div>
            </div>
          )}

          {/* Calendar Modal */}
          {showCalendar && (
            <div 
              onClick={() => setShowCalendar(false)}
              style={{
                position: 'fixed',
                inset: 0,
                background: 'rgba(0, 0, 0, 0.92)',
                zIndex: 1000,
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center',
                padding: '20px',
              }}
            >
              <div 
                onClick={(e) => e.stopPropagation()}
                style={{
                  background: '#1a1333',
                  borderRadius: '20px',
                  padding: '24px',
                  width: '100%',
                  maxWidth: '380px',
                  border: '2px solid rgba(99, 102, 241, 0.3)',
                }}
              >
                <div style={{
                  display: 'flex',
                  justifyContent: 'space-between',
                  alignItems: 'center',
                  marginBottom: '20px',
                }}>
                  <button
                    onClick={() => {
                      const newMonth = new Date(calendarMonth);
                      newMonth.setMonth(newMonth.getMonth() - 1);
                      setCalendarMonth(newMonth);
                    }}
                    style={{
                      background: 'rgba(99, 102, 241, 0.2)',
                      border: 'none',
                      borderRadius: '12px',
                      width: '52px',
                      height: '52px',
                      color: '#a5b4fc',
                      fontSize: '24px',
                      cursor: 'pointer',
                    }}
                  >
                    ‹
                  </button>
                  
                  <h2 style={{
                    color: '#f8fafc',
                    fontSize: '20px',
                    fontWeight: '700',
                    margin: 0,
                  }}>
                    {calendarMonth.toLocaleDateString('en-US', { month: 'long', year: 'numeric' })}
                  </h2>
                  
                  <button
                    onClick={() => {
                      const newMonth = new Date(calendarMonth);
                      newMonth.setMonth(newMonth.getMonth() + 1);
                      setCalendarMonth(newMonth);
                    }}
                    style={{
                      background: 'rgba(99, 102, 241, 0.2)',
                      border: 'none',
                      borderRadius: '12px',
                      width: '52px',
                      height: '52px',
                      color: '#a5b4fc',
                      fontSize: '24px',
                      cursor: 'pointer',
                    }}
                  >
                    ›
                  </button>
                </div>

                <div style={{
                  display: 'grid',
                  gridTemplateColumns: 'repeat(7, 1fr)',
                  gap: '4px',
                  marginBottom: '8px',
                }}>
                  {['S', 'M', 'T', 'W', 'T', 'F', 'S'].map((day, idx) => (
                    <div key={idx} style={{
                      textAlign: 'center',
                      color: '#64748b',
                      fontSize: '13px',
                      fontWeight: '600',
                      padding: '8px 0',
                    }}>
                      {day}
                    </div>
                  ))}
                </div>

                <div style={{
                  display: 'grid',
                  gridTemplateColumns: 'repeat(7, 1fr)',
                  gap: '4px',
                }}>
                  {getCalendarDays().map((day, idx) => {
                    if (!day) return <div key={idx} style={{ aspectRatio: '1' }} />;
                    
                    const dateKey = getDateKey(day);
                    const hasEntries = daysWithEntries.has(dateKey);
                    const isSelected = dateKey === getDateKey(selectedDate);
                    const isToday = dateKey === getDateKey(new Date());
                    
                    return (
                      <button
                        key={idx}
                        onClick={() => selectDate(day)}
                        style={{
                          aspectRatio: '1',
                          borderRadius: '12px',
                          border: isSelected ? '2px solid #6366f1' : isToday ? '2px solid rgba(99, 102, 241, 0.4)' : '2px solid transparent',
                          background: isSelected ? 'rgba(99, 102, 241, 0.3)' : hasEntries ? 'rgba(74, 222, 128, 0.15)' : 'rgba(30, 27, 75, 0.5)',
                          color: isSelected ? '#fff' : hasEntries ? '#4ade80' : '#94a3b8',
                          fontSize: '16px',
                          fontWeight: isSelected || isToday ? '700' : '500',
                          cursor: 'pointer',
                          display: 'flex',
                          alignItems: 'center',
                          justifyContent: 'center',
                          position: 'relative',
                        }}
                      >
                        {day.getDate()}
                        {hasEntries && !isSelected && (
                          <div style={{
                            position: 'absolute',
                            bottom: '6px',
                            width: '4px',
                            height: '4px',
                            borderRadius: '50%',
                            background: '#4ade80',
                          }} />
                        )}
                      </button>
                    );
                  })}
                </div>

                <button
                  onClick={() => selectDate(new Date())}
                  style={{
                    width: '100%',
                    marginTop: '16px',
                    padding: '14px',
                    background: 'rgba(99, 102, 241, 0.2)',
                    border: '1px solid rgba(99, 102, 241, 0.3)',
                    borderRadius: '12px',
                    color: '#a5b4fc',
                    fontSize: '15px',
                    fontWeight: '600',
                    cursor: 'pointer',
                  }}
                >
                  Go to Today
                </button>
              </div>
            </div>
          )}

          {/* Add Symptom Modal */}
          {showAddSymptom && (
            <div 
              onClick={() => setShowAddSymptom(false)}
              style={{
                position: 'fixed',
                inset: 0,
                background: 'rgba(0, 0, 0, 0.92)',
                zIndex: 1000,
                overflowY: 'auto',
                padding: '20px',
              }}
            >
              <div 
                onClick={(e) => e.stopPropagation()}
                style={{ maxWidth: '400px', margin: '0 auto' }}
              >
                <div style={{
                  display: 'flex',
                  justifyContent: 'space-between',
                  alignItems: 'center',
                  marginBottom: '20px',
                }}>
                  <h2 style={{ color: '#f8fafc', fontSize: '22px', fontWeight: '700', margin: 0 }}>
                    Add Symptoms
                  </h2>
                  <button
                    onClick={() => setShowAddSymptom(false)}
                    style={{
                      background: 'rgba(99, 102, 241, 0.2)',
                      border: 'none',
                      borderRadius: '10px',
                      width: '44px',
                      height: '44px',
                      color: '#a5b4fc',
                      fontSize: '20px',
                      cursor: 'pointer',
                    }}
                  >
                    ✕
                  </button>
                </div>

                <div style={{
                  background: 'rgba(30, 27, 75, 0.6)',
                  borderRadius: '12px',
                  padding: '16px',
                  marginBottom: '20px',
                }}>
                  <label style={{
                    color: '#94a3b8',
                    fontSize: '12px',
                    textTransform: 'uppercase',
                    letterSpacing: '1px',
                  }}>Add Multiple Symptoms</label>
                  <p style={{
                    color: '#64748b',
                    fontSize: '12px',
                    margin: '4px 0 10px 0',
                  }}>
                    Paste or type symptoms separated by commas, tabs, or new lines
                  </p>
                  <textarea
                    value={bulkSymptomInput}
                    onChange={(e) => setBulkSymptomInput(e.target.value)}
                    placeholder="Headache, Fatigue, Nausea&#10;Back Pain&#10;Insomnia, Anxiety"
                    rows={4}
                    style={{
                      width: '100%',
                      background: 'rgba(15, 23, 42, 0.8)',
                      border: '2px solid rgba(99, 102, 241, 0.3)',
                      borderRadius: '10px',
                      padding: '12px 14px',
                      color: '#f8fafc',
                      fontSize: '15px',
                      outline: 'none',
                      resize: 'vertical',
                      fontFamily: 'inherit',
                    }}
                  />
                  <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginTop: '10px' }}>
                    <span style={{ color: '#64748b', fontSize: '12px' }}>
                      {parseBulkSymptoms(bulkSymptomInput).length} symptom(s) detected
                    </span>
                    <button
                      onClick={addBulkSymptoms}
                      disabled={parseBulkSymptoms(bulkSymptomInput).length === 0}
                      style={{
                        background: parseBulkSymptoms(bulkSymptomInput).length > 0 ? '#6366f1' : 'rgba(99, 102, 241, 0.3)',
                        border: 'none',
                        borderRadius: '10px',
                        padding: '10px 20px',
                        color: '#fff',
                        fontSize: '14px',
                        fontWeight: '600',
                        cursor: parseBulkSymptoms(bulkSymptomInput).length > 0 ? 'pointer' : 'not-allowed',
                      }}
                    >
                      Add All
                    </button>
                  </div>
                </div>

                {activeSymptoms.length > 0 && (
                  <div style={{ marginBottom: '20px' }}>
                    <label style={{
                      color: '#94a3b8',
                      fontSize: '12px',
                      textTransform: 'uppercase',
                      letterSpacing: '1px',
                    }}>Active Symptoms</label>
                    <div style={{
                      display: 'flex',
                      flexDirection: 'column',
                      gap: '8px',
                      marginTop: '12px',
                    }}>
                      {activeSymptoms.map((symptom) => (
                        <div
                          key={symptom.id}
                          style={{
                            display: 'flex',
                            alignItems: 'center',
                            gap: '8px',
                          }}
                        >
                          {editingSymptomId === symptom.id ? (
                            <div style={{
                              flex: 1,
                              display: 'flex',
                              gap: '8px',
                            }}>
                              <input
                                type="text"
                                value={editingSymptomName}
                                onChange={(e) => setEditingSymptomName(e.target.value)}
                                onKeyDown={(e) => {
                                  if (e.key === 'Enter') saveSymptomName();
                                  if (e.key === 'Escape') cancelEditingSymptom();
                                }}
                                autoFocus
                                style={{
                                  flex: 1,
                                  background: 'rgba(99, 102, 241, 0.2)',
                                  border: '2px solid rgba(99, 102, 241, 0.5)',
                                  borderRadius: '8px',
                                  padding: '10px 12px',
                                  color: '#fff',
                                  fontSize: '14px',
                                  outline: 'none',
                                }}
                              />
                              <button
                                onClick={saveSymptomName}
                                style={{
                                  background: 'rgba(74, 222, 128, 0.2)',
                                  border: '2px solid rgba(74, 222, 128, 0.4)',
                                  borderRadius: '8px',
                                  padding: '10px 14px',
                                  color: '#86efac',
                                  fontSize: '14px',
                                  cursor: 'pointer',
                                }}
                              >
                                ✓
                              </button>
                              <button
                                onClick={cancelEditingSymptom}
                                style={{
                                  background: 'rgba(239, 68, 68, 0.15)',
                                  border: '2px solid rgba(239, 68, 68, 0.3)',
                                  borderRadius: '8px',
                                  padding: '10px 14px',
                                  color: '#fca5a5',
                                  fontSize: '14px',
                                  cursor: 'pointer',
                                }}
                              >
                                ✕
                              </button>
                            </div>
                          ) : (
                            <>
                              <button
                                onClick={() => startEditingSymptom(symptom)}
                                style={{
                                  background: 'rgba(99, 102, 241, 0.15)',
                                  border: '2px solid rgba(99, 102, 241, 0.3)',
                                  borderRadius: '8px',
                                  padding: '10px 12px',
                                  color: '#a5b4fc',
                                  fontSize: '14px',
                                  cursor: 'pointer',
                                }}
                              >
                                ✎
                              </button>
                              <span style={{
                                flex: 1,
                                color: '#e2e8f0',
                                fontSize: '14px',
                              }}>
                                {symptom.name}
                              </span>
                              <button
                                onClick={() => removeSymptom(symptom.id)}
                                style={{
                                  background: 'rgba(239, 68, 68, 0.15)',
                                  border: '2px solid rgba(239, 68, 68, 0.3)',
                                  borderRadius: '8px',
                                  padding: '10px 14px',
                                  color: '#fca5a5',
                                  fontSize: '14px',
                                  cursor: 'pointer',
                                }}
                              >
                                ✕
                              </button>
                            </>
                          )}
                        </div>
                      ))}
                    </div>
                  </div>
                )}

                {inactiveSymptoms.length > 0 && (
                  <div>
                    <label style={{
                      color: '#94a3b8',
                      fontSize: '12px',
                      textTransform: 'uppercase',
                      letterSpacing: '1px',
                    }}>Hidden Symptoms</label>
                    <div style={{
                      display: 'flex',
                      flexDirection: 'column',
                      gap: '8px',
                      marginTop: '12px',
                    }}>
                      {inactiveSymptoms.map((symptom) => (
                        <div
                          key={symptom.id}
                          style={{
                            display: 'flex',
                            alignItems: 'center',
                            gap: '8px',
                          }}
                        >
                          {editingSymptomId === symptom.id ? (
                            <div style={{
                              flex: 1,
                              display: 'flex',
                              gap: '8px',
                            }}>
                              <input
                                type="text"
                                value={editingSymptomName}
                                onChange={(e) => setEditingSymptomName(e.target.value)}
                                onKeyDown={(e) => {
                                  if (e.key === 'Enter') saveSymptomName();
                                  if (e.key === 'Escape') cancelEditingSymptom();
                                }}
                                autoFocus
                                style={{
                                  flex: 1,
                                  background: 'rgba(99, 102, 241, 0.2)',
                                  border: '2px solid rgba(99, 102, 241, 0.5)',
                                  borderRadius: '8px',
                                  padding: '10px 12px',
                                  color: '#fff',
                                  fontSize: '14px',
                                  outline: 'none',
                                }}
                              />
                              <button
                                onClick={saveSymptomName}
                                style={{
                                  background: 'rgba(74, 222, 128, 0.2)',
                                  border: '2px solid rgba(74, 222, 128, 0.4)',
                                  borderRadius: '8px',
                                  padding: '10px 14px',
                                  color: '#86efac',
                                  fontSize: '14px',
                                  cursor: 'pointer',
                                }}
                              >
                                ✓
                              </button>
                              <button
                                onClick={cancelEditingSymptom}
                                style={{
                                  background: 'rgba(239, 68, 68, 0.15)',
                                  border: '2px solid rgba(239, 68, 68, 0.3)',
                                  borderRadius: '8px',
                                  padding: '10px 14px',
                                  color: '#fca5a5',
                                  fontSize: '14px',
                                  cursor: 'pointer',
                                }}
                              >
                                ✕
                              </button>
                            </div>
                          ) : (
                            <>
                              <button
                                onClick={() => startEditingSymptom(symptom)}
                                style={{
                                  background: 'rgba(99, 102, 241, 0.15)',
                                  border: '2px solid rgba(99, 102, 241, 0.3)',
                                  borderRadius: '8px',
                                  padding: '10px 12px',
                                  color: '#a5b4fc',
                                  fontSize: '14px',
                                  cursor: 'pointer',
                                }}
                              >
                                ✎
                              </button>
                              <span style={{
                                flex: 1,
                                color: '#94a3b8',
                                fontSize: '14px',
                              }}>
                                {symptom.name}
                              </span>
                              <button
                                onClick={() => reactivateSymptom(symptom.id)}
                                style={{
                                  background: 'rgba(74, 222, 128, 0.15)',
                                  border: '2px solid rgba(74, 222, 128, 0.3)',
                                  borderRadius: '8px',
                                  padding: '10px 14px',
                                  color: '#86efac',
                                  fontSize: '14px',
                                  cursor: 'pointer',
                                }}
                              >
                                +
                              </button>
                            </>
                          )}
                        </div>
                      ))}
                    </div>
                  </div>
                )}
              </div>
            </div>
          )}

          {/* History Modal with Sortable Table */}
          {showHistory && (
            <div 
              onClick={() => setShowHistory(false)}
              style={{
                position: 'fixed',
                inset: 0,
                background: 'rgba(0, 0, 0, 0.92)',
                zIndex: 1000,
                overflowY: 'auto',
                padding: '20px',
              }}
            >
              <div 
                onClick={(e) => e.stopPropagation()}
                style={{ maxWidth: '600px', margin: '0 auto' }}
              >
                {/* Header */}
                <div style={{
                  display: 'flex',
                  justifyContent: 'space-between',
                  alignItems: 'center',
                  marginBottom: '16px',
                  position: 'sticky',
                  top: 0,
                  background: 'rgba(12, 10, 29, 0.98)',
                  padding: '10px 0',
                  zIndex: 10,
                }}>
                  <div>
                    <h2 style={{ color: '#f8fafc', fontSize: '22px', fontWeight: '700', margin: 0 }}>
                      History
                    </h2>
                    <p style={{ color: '#64748b', fontSize: '12px', margin: '4px 0 0 0' }}>
                      {sortedHistory.length} entries • Tap column headers to sort
                    </p>
                  </div>
                  <button
                    onClick={() => setShowHistory(false)}
                    style={{
                      background: 'rgba(99, 102, 241, 0.2)',
                      border: 'none',
                      borderRadius: '10px',
                      width: '44px',
                      height: '44px',
                      color: '#a5b4fc',
                      fontSize: '20px',
                      cursor: 'pointer',
                    }}
                  >
                    ✕
                  </button>
                </div>

                {sortedHistory.length === 0 ? (
                  <p style={{ color: '#64748b', textAlign: 'center', padding: '40px 0' }}>
                    No entries recorded yet
                  </p>
                ) : (
                  <div style={{
                    background: 'rgba(30, 27, 75, 0.5)',
                    borderRadius: '12px',
                    overflow: 'hidden',
                    border: '1px solid rgba(99, 102, 241, 0.2)',
                  }}>
                    <table style={{
                      width: '100%',
                      borderCollapse: 'collapse',
                    }}>
                      <thead>
                        <tr style={{ background: 'rgba(30, 27, 75, 0.8)' }}>
                          <th 
                            onClick={() => toggleSort('date')}
                            style={tableHeaderStyle}
                          >
                            Date{getSortIndicator('date')}
                          </th>
                          <th 
                            onClick={() => toggleSort('symptom')}
                            style={tableHeaderStyle}
                          >
                            Symptom{getSortIndicator('symptom')}
                          </th>
                          <th 
                            onClick={() => toggleSort('time')}
                            style={tableHeaderStyle}
                          >
                            Time{getSortIndicator('time')}
                          </th>
                          <th 
                            onClick={() => toggleSort('severity')}
                            style={{...tableHeaderStyle, textAlign: 'center'}}
                          >
                            Severity{getSortIndicator('severity')}
                          </th>
                        </tr>
                      </thead>
                      <tbody>
                        {sortedHistory.map((entry, idx) => (
                          <tr 
                            key={entry.key}
                            style={{
                              background: idx % 2 === 0 ? 'transparent' : 'rgba(99, 102, 241, 0.03)',
                            }}
                          >
                            <td style={{...tableCellStyle, color: '#94a3b8', whiteSpace: 'nowrap'}}>
                              {formatTableDate(entry.date)}
                            </td>
                            <td style={{...tableCellStyle, color: '#e2e8f0', fontWeight: '500'}}>
                              {entry.symptomName}
                            </td>
                            <td style={{...tableCellStyle, color: '#94a3b8'}}>
                              <span style={{ marginRight: '6px', color: '#a5b4fc' }}>
                                {timePeriods.find(t => t.id === entry.time)?.icon}
                              </span>
                              {entry.timePeriodLabel}
                            </td>
                            <td style={{...tableCellStyle, textAlign: 'center'}}>
                              <span style={{
                                display: 'inline-block',
                                minWidth: '28px',
                                padding: '4px 8px',
                                borderRadius: '6px',
                                background: `${severityColors[entry.severity]}20`,
                                color: severityColors[entry.severity],
                                fontWeight: '700',
                                fontSize: '13px',
                              }}>
                                {entry.severity}
                              </span>
                            </td>
                          </tr>
                        ))}
                      </tbody>
                    </table>
                  </div>
                )}
              </div>
            </div>
          )}

          {/* Export Modal */}
          {showExport && (
            <div 
              onClick={() => setShowExport(false)}
              style={{
                position: 'fixed',
                inset: 0,
                background: 'rgba(0, 0, 0, 0.92)',
                zIndex: 1000,
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center',
                padding: '20px',
              }}
            >
              <div 
                onClick={(e) => e.stopPropagation()}
                style={{
                  background: '#1a1333',
                  borderRadius: '20px',
                  padding: '24px',
                  width: '100%',
                  maxWidth: '320px',
                  maxHeight: '80vh',
                  overflowY: 'auto',
                  border: '2px solid rgba(99, 102, 241, 0.3)',
                }}
              >
                <h2 style={{
                  color: '#f8fafc',
                  fontSize: '20px',
                  fontWeight: '700',
                  margin: '0 0 20px 0',
                  textAlign: 'center',
                }}>
                  Export to CSV
                </h2>
                
                <div style={{ display: 'flex', flexDirection: 'column', gap: '8px' }}>
                  {[
                    { label: 'Last 7 days', days: 7 },
                    { label: 'Last 30 days', days: 30 },
                    { label: 'Last 3 months', days: 90 },
                    { label: 'Last 6 months', days: 180 },
                    { label: 'Last 12 months', days: 365 },
                    { label: 'Last 2 years', days: 730 },
                    { label: 'Last 3 years', days: 1095 },
                    { label: 'Last 4 years', days: 1460 },
                    { label: 'All time', days: 99999 },
                  ].map(({ label, days }) => (
                    <button
                      key={days}
                      onClick={() => exportCSV(days)}
                      style={{
                        background: 'rgba(99, 102, 241, 0.15)',
                        border: '1px solid rgba(99, 102, 241, 0.3)',
                        borderRadius: '10px',
                        padding: '12px 16px',
                        color: '#e2e8f0',
                        fontSize: '15px',
                        fontWeight: '500',
                        cursor: 'pointer',
                        textAlign: 'left',
                      }}
                    >
                      {label}
                    </button>
                  ))}
                </div>

                <button
                  onClick={() => setShowExport(false)}
                  style={{
                    width: '100%',
                    marginTop: '16px',
                    padding: '14px',
                    background: 'transparent',
                    border: '1px solid rgba(99, 102, 241, 0.3)',
                    borderRadius: '12px',
                    color: '#94a3b8',
                    fontSize: '15px',
                    cursor: 'pointer',
                  }}
                >
                  Cancel
                </button>
              </div>
            </div>
          )}

          {/* Insights Modal */}
          {showInsights && (() => {
            const insights = getInsights();
            
            return (
              <div 
                onClick={() => setShowInsights(false)}
                style={{
                  position: 'fixed',
                  inset: 0,
                  background: 'rgba(0, 0, 0, 0.95)',
                  zIndex: 1000,
                  overflowY: 'auto',
                  padding: '20px',
                }}
              >
                <div 
                  onClick={(e) => e.stopPropagation()}
                  style={{ maxWidth: '500px', margin: '0 auto' }}
                >
                  {/* Header */}
                  <div style={{
                    display: 'flex',
                    justifyContent: 'space-between',
                    alignItems: 'center',
                    marginBottom: '20px',
                  }}>
                    <h2 style={{ color: '#f8fafc', fontSize: '24px', fontWeight: '700', margin: 0 }}>
                      Insights
                    </h2>
                    <button
                      onClick={() => setShowInsights(false)}
                      style={{
                        background: 'transparent',
                        border: 'none',
                        color: '#94a3b8',
                        fontSize: '24px',
                        cursor: 'pointer',
                      }}
                    >
                      ✕
                    </button>
                  </div>

                  {!insights.hasEnoughData ? (
                    <div style={{
                      background: 'rgba(99, 102, 241, 0.1)',
                      border: '1px solid rgba(99, 102, 241, 0.3)',
                      borderRadius: '16px',
                      padding: '24px',
                      textAlign: 'center',
                    }}>
                      <div style={{ fontSize: '48px', marginBottom: '12px' }}>📊</div>
                      <p style={{ color: '#e2e8f0', fontSize: '16px', margin: 0 }}>
                        Need more data for insights
                      </p>
                      <p style={{ color: '#94a3b8', fontSize: '14px', marginTop: '8px' }}>
                        Keep tracking for at least a week to see patterns emerge.
                      </p>
                    </div>
                  ) : (
                    <>
                      {/* Summary */}
                      <div style={{
                        background: 'rgba(99, 102, 241, 0.1)',
                        borderRadius: '12px',
                        padding: '16px',
                        marginBottom: '20px',
                      }}>
                        <p style={{ color: '#94a3b8', fontSize: '13px', margin: 0 }}>
                          Analyzing {insights.totalEntries} entries from {insights.dateRange.start} to {insights.dateRange.end}
                        </p>
                      </div>

                      {/* Trends Section */}
                      {insights.trends.length > 0 && (
                        <div style={{ marginBottom: '24px' }}>
                          <h3 style={{
                            color: '#94a3b8',
                            fontSize: '12px',
                            textTransform: 'uppercase',
                            letterSpacing: '1px',
                            marginBottom: '12px',
                          }}>
                            Symptom Trends (30 days vs prior)
                          </h3>
                          <div style={{ display: 'flex', flexDirection: 'column', gap: '8px' }}>
                            {insights.trends.map(t => (
                              <div
                                key={t.symptomId}
                                style={{
                                  background: t.trend === 'improving' 
                                    ? 'rgba(74, 222, 128, 0.15)'
                                    : t.trend === 'worsening'
                                    ? 'rgba(239, 68, 68, 0.15)'
                                    : 'rgba(148, 163, 184, 0.15)',
                                  border: `1px solid ${
                                    t.trend === 'improving' 
                                      ? 'rgba(74, 222, 128, 0.3)'
                                      : t.trend === 'worsening'
                                      ? 'rgba(239, 68, 68, 0.3)'
                                      : 'rgba(148, 163, 184, 0.3)'
                                  }`,
                                  borderRadius: '12px',
                                  padding: '14px 16px',
                                }}
                              >
                                <div style={{
                                  display: 'flex',
                                  justifyContent: 'space-between',
                                  alignItems: 'center',
                                }}>
                                  <span style={{
                                    color: '#e2e8f0',
                                    fontSize: '14px',
                                    fontWeight: '500',
                                  }}>
                                    {t.name}
                                  </span>
                                  <span style={{
                                    color: t.trend === 'improving' 
                                      ? '#86efac'
                                      : t.trend === 'worsening'
                                      ? '#fca5a5'
                                      : '#94a3b8',
                                    fontSize: '13px',
                                    fontWeight: '600',
                                  }}>
                                    {t.trend === 'improving' ? '↓' : t.trend === 'worsening' ? '↑' : '→'} {t.trend}
                                  </span>
                                </div>
                                <div style={{
                                  color: '#94a3b8',
                                  fontSize: '12px',
                                  marginTop: '6px',
                                }}>
                                  {t.earlierAvg} → {t.recentAvg} avg severity ({t.change > 0 ? '+' : ''}{t.change})
                                </div>
                              </div>
                            ))}
                          </div>
                        </div>
                      )}

                      {/* Clusters Section */}
                      {insights.clusters.length > 0 && (
                        <div style={{ marginBottom: '24px' }}>
                          <h3 style={{
                            color: '#94a3b8',
                            fontSize: '12px',
                            textTransform: 'uppercase',
                            letterSpacing: '1px',
                            marginBottom: '12px',
                          }}>
                            Symptom Clusters
                          </h3>
                          <div style={{
                            background: 'rgba(251, 146, 60, 0.1)',
                            border: '1px solid rgba(251, 146, 60, 0.3)',
                            borderRadius: '12px',
                            padding: '16px',
                          }}>
                            <p style={{
                              color: '#fed7aa',
                              fontSize: '13px',
                              margin: '0 0 12px 0',
                            }}>
                              These symptoms frequently appear together:
                            </p>
                            {insights.clusters.map((c, idx) => (
                              <div
                                key={idx}
                                style={{
                                  color: '#e2e8f0',
                                  fontSize: '14px',
                                  padding: '8px 0',
                                  borderTop: idx > 0 ? '1px solid rgba(251, 146, 60, 0.2)' : 'none',
                                }}
                              >
                                <strong>{c.pair[0]}</strong> + <strong>{c.pair[1]}</strong>
                                <span style={{ color: '#94a3b8', marginLeft: '8px' }}>
                                  ({c.count} days)
                                </span>
                              </div>
                            ))}
                          </div>
                        </div>
                      )}

                      {/* Time Patterns */}
                      {insights.timeInsights.length > 1 && (
                        <div style={{ marginBottom: '24px' }}>
                          <h3 style={{
                            color: '#94a3b8',
                            fontSize: '12px',
                            textTransform: 'uppercase',
                            letterSpacing: '1px',
                            marginBottom: '12px',
                          }}>
                            Time of Day Patterns
                          </h3>
                          <div style={{
                            display: 'flex',
                            gap: '8px',
                            flexWrap: 'wrap',
                          }}>
                            {insights.timeInsights.map(t => (
                              <div
                                key={t.time}
                                style={{
                                  background: 'rgba(99, 102, 241, 0.15)',
                                  border: '1px solid rgba(99, 102, 241, 0.3)',
                                  borderRadius: '10px',
                                  padding: '12px 16px',
                                  textAlign: 'center',
                                  flex: '1',
                                  minWidth: '80px',
                                }}
                              >
                                <div style={{ color: '#a5b4fc', fontSize: '12px', marginBottom: '4px' }}>
                                  {t.label}
                                </div>
                                <div style={{
                                  color: severityColors[Math.round(t.avgSeverity)],
                                  fontSize: '20px',
                                  fontWeight: '700',
                                }}>
                                  {t.avgSeverity}
                                </div>
                              </div>
                            ))}
                          </div>
                        </div>
                      )}

                      {/* Weekly Patterns */}
                      {insights.weeklyInsights.length > 0 && (
                        <div style={{ marginBottom: '24px' }}>
                          <h3 style={{
                            color: '#94a3b8',
                            fontSize: '12px',
                            textTransform: 'uppercase',
                            letterSpacing: '1px',
                            marginBottom: '12px',
                          }}>
                            Weekly Patterns
                          </h3>
                          <div style={{
                            display: 'flex',
                            gap: '6px',
                          }}>
                            {insights.weeklyInsights.map(w => (
                              <div
                                key={w.day}
                                style={{
                                  flex: 1,
                                  background: 'rgba(99, 102, 241, 0.1)',
                                  borderRadius: '8px',
                                  padding: '10px 4px',
                                  textAlign: 'center',
                                }}
                              >
                                <div style={{ color: '#64748b', fontSize: '10px', marginBottom: '4px' }}>
                                  {w.day}
                                </div>
                                <div style={{
                                  color: severityColors[Math.round(w.avgSeverity)],
                                  fontSize: '14px',
                                  fontWeight: '600',
                                }}>
                                  {w.avgSeverity}
                                </div>
                              </div>
                            ))}
                          </div>
                        </div>
                      )}

                      {/* AI Analysis Button */}
                      <div style={{ marginBottom: '24px' }}>
                        <h3 style={{
                          color: '#94a3b8',
                          fontSize: '12px',
                          textTransform: 'uppercase',
                          letterSpacing: '1px',
                          marginBottom: '12px',
                        }}>
                          AI Analysis
                        </h3>
                        <button
                          onClick={() => {
                            navigator.clipboard.writeText(insights.aiPrompt);
                            setLastAction('Copied to clipboard - paste into Claude for AI analysis');
                            setShowInsights(false);
                          }}
                          style={{
                            width: '100%',
                            background: 'linear-gradient(135deg, rgba(99, 102, 241, 0.2) 0%, rgba(139, 92, 246, 0.2) 100%)',
                            border: '2px solid rgba(139, 92, 246, 0.4)',
                            borderRadius: '12px',
                            padding: '16px',
                            color: '#c4b5fd',
                            fontSize: '15px',
                            fontWeight: '500',
                            cursor: 'pointer',
                            textAlign: 'center',
                          }}
                        >
                          <div style={{ fontSize: '24px', marginBottom: '8px' }}>🤖</div>
                          <div style={{ fontWeight: '600' }}>Copy for AI Analysis</div>
                          <div style={{ fontSize: '12px', opacity: 0.8, marginTop: '4px' }}>
                            Paste into Claude for deeper pattern recognition
                          </div>
                        </button>
                      </div>

                      <p style={{
                        color: '#64748b',
                        fontSize: '11px',
                        textAlign: 'center',
                        margin: 0,
                        fontStyle: 'italic',
                      }}>
                        These insights are for informational purposes only and should not be considered medical advice.
                      </p>
                    </>
                  )}
                </div>
              </div>
            );
          })()}

          {/* Settings Modal */}
          {showSettings && (
            <div 
              onClick={() => setShowSettings(false)}
              style={{
                position: 'fixed',
                inset: 0,
                background: 'rgba(0, 0, 0, 0.92)',
                zIndex: 1000,
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center',
                padding: '20px',
              }}
            >
              <div 
                onClick={(e) => e.stopPropagation()}
                style={{
                  background: '#1a1333',
                  borderRadius: '20px',
                  padding: '24px',
                  width: '100%',
                  maxWidth: '320px',
                  border: '2px solid rgba(99, 102, 241, 0.3)',
                }}
              >
                <h2 style={{
                  color: '#f8fafc',
                  fontSize: '20px',
                  fontWeight: '700',
                  margin: '0 0 20px 0',
                  textAlign: 'center',
                }}>
                  Settings
                </h2>
                
                {/* Tracking Mode Selection */}
                <div style={{ marginBottom: '20px' }}>
                  <label style={{
                    color: '#94a3b8',
                    fontSize: '12px',
                    textTransform: 'uppercase',
                    letterSpacing: '1px',
                    display: 'block',
                    marginBottom: '12px',
                  }}>Tracking Mode</label>
                  <div style={{ display: 'flex', flexDirection: 'column', gap: '8px' }}>
                    {Object.entries(trackingModes).map(([key, mode]) => (
                      <button
                        key={key}
                        onClick={() => setTrackingMode(key)}
                        style={{
                          background: trackingMode === key ? 'rgba(99, 102, 241, 0.25)' : 'rgba(99, 102, 241, 0.1)',
                          border: trackingMode === key ? '2px solid rgba(99, 102, 241, 0.6)' : '2px solid rgba(99, 102, 241, 0.2)',
                          borderRadius: '12px',
                          padding: '12px 16px',
                          color: trackingMode === key ? '#fff' : '#a5b4fc',
                          fontSize: '14px',
                          fontWeight: '500',
                          cursor: 'pointer',
                          textAlign: 'left',
                          display: 'flex',
                          justifyContent: 'space-between',
                          alignItems: 'center',
                        }}
                      >
                        <div>
                          <div style={{ fontWeight: '600' }}>{mode.label}</div>
                          <div style={{ fontSize: '11px', opacity: 0.7, marginTop: '2px' }}>{mode.description}</div>
                        </div>
                        {trackingMode === key && <span style={{ fontSize: '16px' }}>✓</span>}
                      </button>
                    ))}
                  </div>
                </div>
                
                <div style={{ display: 'flex', flexDirection: 'column', gap: '10px' }}>
                  {!hasSampleData && (
                    <button
                      onClick={loadSampleData}
                      style={{
                        background: 'rgba(74, 222, 128, 0.15)',
                        border: '2px solid rgba(74, 222, 128, 0.3)',
                        borderRadius: '12px',
                        padding: '16px',
                        color: '#86efac',
                        fontSize: '15px',
                        fontWeight: '500',
                        cursor: 'pointer',
                        textAlign: 'left',
                      }}
                    >
                      <div style={{ fontWeight: '600', marginBottom: '4px' }}>Load Sample Data</div>
                      <div style={{ fontSize: '12px', opacity: 0.8 }}>
                        Generate 6 months of example entries with trends
                      </div>
                    </button>
                  )}

                  <button
                    onClick={clearAllData}
                    style={{
                      background: 'rgba(239, 68, 68, 0.15)',
                      border: '2px solid rgba(239, 68, 68, 0.3)',
                      borderRadius: '12px',
                      padding: '16px',
                      color: '#fca5a5',
                      fontSize: '15px',
                      fontWeight: '500',
                      cursor: 'pointer',
                      textAlign: 'left',
                    }}
                  >
                    <div style={{ fontWeight: '600', marginBottom: '4px' }}>Clear All Data</div>
                    <div style={{ fontSize: '12px', opacity: 0.8 }}>
                      Remove all recorded entries
                    </div>
                  </button>
                </div>

                <button
                  onClick={() => setShowSettings(false)}
                  style={{
                    width: '100%',
                    marginTop: '16px',
                    padding: '14px',
                    background: 'transparent',
                    border: '1px solid rgba(99, 102, 241, 0.3)',
                    borderRadius: '12px',
                    color: '#94a3b8',
                    fontSize: '15px',
                    cursor: 'pointer',
                  }}
                >
                  Close
                </button>
              </div>
            </div>
          )}

          {/* Success Toast */}
          {lastAction && !isDragging && !showAddSymptom && !showCalendar && !showHistory && !showExport && !showSettings && !showInsights && (
            <div style={{
              position: 'fixed',
              bottom: '28px',
              left: '50%',
              transform: 'translateX(-50%)',
              background: 'rgba(30, 27, 75, 0.95)',
              border: '1px solid rgba(99, 102, 241, 0.4)',
              borderRadius: '10px',
              padding: '10px 18px',
              color: '#a5b4fc',
              fontSize: '13px',
              fontWeight: '500',
              boxShadow: '0 10px 40px rgba(0,0,0,0.4)',
              animation: 'slideUp 0.3s ease',
            }}>
              ✓ {lastAction}
            </div>
          )}

          <style>{`
            @keyframes slideUp {
              from { opacity: 0; transform: translateX(-50%) translateY(20px); }
              to { opacity: 1; transform: translateX(-50%) translateY(0); }
            }
            input::placeholder, textarea::placeholder {
              color: #64748b;
            }
            * {
              -webkit-user-select: none;
              -webkit-touch-callout: none;
              -webkit-tap-highlight-color: transparent;
              user-select: none;
            }
            input, textarea {
              -webkit-user-select: text;
              user-select: text;
            }
          `}</style>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<SymptomTrackerMobile />);
  </script>
</body>
</html>
